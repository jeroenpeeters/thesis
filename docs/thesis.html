<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="Content-Style-Type" content="text/css" />
        <meta name="generator" content="pandoc" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
                        <title></title>
        <style type="text/css">code{white-space: pre;}</style>
                                                    <style>
            body {
                font-family: Georgia;
                max-width: 800px;
                margin: 0 auto;
                line-height: 30px;
                font-size: 18px;
                padding-left: 350px;
                padding-right: 50px;
                color: #111;
            }
            
            h1, h2, h3, h4, h5, h6 {
                font-family: Arial;
            }
            
            h1 {
                padding-top: 200px;
                line-height: 50px;
            }
            h2 {
                padding-top: 30px;
            }
            h3 {
                padding-top: 20px;
            }
            h4 {
                padding-top: 10px;
            }
            p {
                text-align: justify;
            }
            p a {
                word-wrap: break-word;
                white-space: pre;
            }
            code {
                word-wrap: break-word;
            }
            blockquote {
                border-left: 3px solid #eee;
                margin-left: 20px;
                padding-left: 20px;
            }
            
            ::selection {
                background-color: #E4E4E4;
            }
            
            table {
                width: 100%;
            }
            table caption {
                font-weight: bold;
            }
            table tr {
                padding: 0;
                margin: 0;
                background-color: #f0f0f0;
            }
            table tr.even {
                background-color: #fafafa;
            }
            table td {
                margin: 0;
                padding: 3px 5px;
            }
            
            p span.added {
                color: green;
                background-color: #FFF3C5;
            }
            p span.removed {
                color: red;
                background-color: #FFF3C5;
            }
            
            #title-page {
                padding: 80px 0;
            }
            
            #TOC {
                position: fixed;
                left: 0;
                top: 0;
                overflow-y: scroll;
                height: 100%;
                background: #fafafa;
                max-width: 300px;
                font-family: Arial;
                font-size: 15px;
                line-height: 30px;
            }
            ::-webkit-scrollbar {
                width: 8px;
            }
            ::-webkit-scrollbar-track {
                background-color: #ECECEC;
            }
            ::-webkit-scrollbar-thumb {
                background-color: #B0B0B0;
                border-radius: 8px;
            }
            #TOC > ul {
                padding-right: 10px;
            }
            #TOC ul {
                list-style: none;
                padding-left: 20px;
            }
            #TOC ul li a {
                text-decoration: none;
                color: #364149;
                text-overflow: ellipsis;
                display: block;
                white-space: nowrap;
                overflow: hidden;
            }
            #TOC ul li a:hover {
                color: #008cff;
            }
            
            .figure {
                text-align: center;
            }
            .figure p {
                text-align: center;
                font-style: italic;
            }
            .figure img {
                  max-width: 100%;
            }
            </style>
                <script src="js/jquery.js"></script>
        <script src="js/diff.js"></script>
        <script src="js/main.js"></script>
    </head>
    <body>
                <!--
                -->
        <div id="title-page">
            <h1>Continuous Delivery</h1>
            <h2>Jeroen Peeters</h2>
        </div>
                    <div id="TOC">
                <ul>
                <li><a href="#abstract">Abstract</a></li>
                <li><a href="#acknowledgements">Acknowledgements</a></li>
                <li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
                <li><a href="#literature-review"><span class="toc-section-number">2</span> Literature review</a><ul>
                <li><a href="#introduction-1"><span class="toc-section-number">2.1</span> Introduction</a></li>
                <li><a href="#tools"><span class="toc-section-number">2.2</span> Tools</a></li>
                <li><a href="#process"><span class="toc-section-number">2.3</span> Process</a></li>
                <li><a href="#people"><span class="toc-section-number">2.4</span> People</a></li>
                <li><a href="#methodoloy"><span class="toc-section-number">2.5</span> Methodoloy</a></li>
                </ul></li>
                <li><a href="#the-development-organization"><span class="toc-section-number">3</span> The development organization</a></li>
                <li><a href="#what-is-continuous-delivery"><span class="toc-section-number">4</span> What is Continuous Delivery</a><ul>
                <li><a href="#continuous-integration"><span class="toc-section-number">4.1</span> Continuous Integration</a><ul>
                <li><a href="#revision-control-system"><span class="toc-section-number">4.1.1</span> Revision Control System</a></li>
                <li><a href="#continuous-integration-server"><span class="toc-section-number">4.1.2</span> Continuous Integration Server</a></li>
                </ul></li>
                <li><a href="#continuous-delivery"><span class="toc-section-number">4.2</span> Continuous Delivery</a></li>
                </ul></li>
                <li><a href="#continuous-delivery-at-the-development-organization"><span class="toc-section-number">5</span> Continuous Delivery at the Development Organization</a><ul>
                <li><a href="#scenarios"><span class="toc-section-number">5.1</span> Scenario's</a><ul>
                <li><a href="#scenario-1-a-new-project"><span class="toc-section-number">5.1.1</span> Scenario 1: A new project</a></li>
                <li><a href="#scenario-use-a-new-version-of-java"><span class="toc-section-number">5.1.2</span> Scenario: Use a new version of Java</a></li>
                <li><a href="#scenario-upgrade-the-application-server"><span class="toc-section-number">5.1.3</span> Scenario: Upgrade the application server</a></li>
                <li><a href="#scenario-application-instance-per-tester"><span class="toc-section-number">5.1.4</span> Scenario: Application instance per tester</a></li>
                <li><a href="#scenario-parallel-frontend-test-execution"><span class="toc-section-number">5.1.5</span> Scenario: Parallel frontend test execution</a></li>
                <li><a href="#scenario-install-a-plugin-in-jenkins-ci"><span class="toc-section-number">5.1.6</span> Scenario: Install a plugin in Jenkins CI</a></li>
                <li><a href="#scenario-upgrade-jenkins-ci"><span class="toc-section-number">5.1.7</span> Scenario: Upgrade Jenkins CI</a></li>
                <li><a href="#scenario-switch-to-another-tool"><span class="toc-section-number">5.1.8</span> Scenario: Switch to another tool</a></li>
                </ul></li>
                <li><a href="#ci-in-a-shared-environment"><span class="toc-section-number">5.2</span> CI in a shared environment</a><ul>
                <li><a href="#the-situation"><span class="toc-section-number">5.2.1</span> The situation</a></li>
                <li><a href="#scenario-a-new-project"><span class="toc-section-number">5.2.2</span> Scenario: A new project</a></li>
                <li><a href="#scenario-use-a-new-version-of-java-1"><span class="toc-section-number">5.2.3</span> Scenario: Use a new version of Java</a></li>
                <li><a href="#scenario-upgrade-the-application-server-1"><span class="toc-section-number">5.2.4</span> Scenario: Upgrade the application server</a></li>
                <li><a href="#scenario-application-instance-per-tester-1"><span class="toc-section-number">5.2.5</span> Scenario: Application instance per tester</a></li>
                <li><a href="#scenario-parallel-frontend-test-execution-1"><span class="toc-section-number">5.2.6</span> Scenario: Parallel frontend test execution</a></li>
                <li><a href="#scenario-install-a-plugin-in-jenkins-ci-1"><span class="toc-section-number">5.2.7</span> Scenario: Install a plugin in Jenkins CI</a></li>
                <li><a href="#scenario-upgrade-jenkins-ci-1"><span class="toc-section-number">5.2.8</span> Scenario: Upgrade Jenkins CI</a></li>
                <li><a href="#scenario-switch-to-another-tool-1"><span class="toc-section-number">5.2.9</span> Scenario: Switch to another tool</a></li>
                </ul></li>
                <li><a href="#ci-in-a-distributed-environment"><span class="toc-section-number">5.3</span> CI in a distributed environment</a><ul>
                <li><a href="#the-situation-1"><span class="toc-section-number">5.3.1</span> The situation</a></li>
                <li><a href="#scenario-a-new-project-1"><span class="toc-section-number">5.3.2</span> Scenario: A new project</a></li>
                <li><a href="#scenario-use-a-new-version-of-java-2"><span class="toc-section-number">5.3.3</span> Scenario: Use a new version of Java</a></li>
                <li><a href="#scenario-upgrade-the-application-server-2"><span class="toc-section-number">5.3.4</span> Scenario: Upgrade the application server</a></li>
                <li><a href="#scenario-application-instance-per-tester-2"><span class="toc-section-number">5.3.5</span> Scenario: Application instance per tester</a></li>
                <li><a href="#scenario-parallel-frontend-test-execution-2"><span class="toc-section-number">5.3.6</span> Scenario: Parallel frontend test execution</a></li>
                <li><a href="#scenario-install-a-plugin-in-jenkins-ci-2"><span class="toc-section-number">5.3.7</span> Scenario: Install a plugin in Jenkins CI</a></li>
                <li><a href="#scenario-upgrade-jenkins-ci-2"><span class="toc-section-number">5.3.8</span> Scenario: Upgrade Jenkins CI</a></li>
                <li><a href="#scenario-switch-to-another-tool-2"><span class="toc-section-number">5.3.9</span> Scenario: Switch to another tool</a></li>
                </ul></li>
                <li><a href="#a-new-project"><span class="toc-section-number">5.4</span> A new project</a><ul>
                <li><a href="#infrastructure-setup"><span class="toc-section-number">5.4.1</span> Infrastructure setup</a></li>
                <li><a href="#project-setup"><span class="toc-section-number">5.4.2</span> Project setup</a></li>
                <li><a href="#recurring-tasks"><span class="toc-section-number">5.4.3</span> Recurring tasks</a></li>
                </ul></li>
                <li><a href="#configuring-the-cd-pipeline"><span class="toc-section-number">5.5</span> Configuring the CD-pipeline</a><ul>
                <li><a href="#nexus-1"><span class="toc-section-number">5.5.1</span> Nexus</a></li>
                <li><a href="#gitlab-1"><span class="toc-section-number">5.5.2</span> Gitlab</a></li>
                <li><a href="#docker-registry"><span class="toc-section-number">5.5.3</span> Docker Registry</a></li>
                <li><a href="#sonar"><span class="toc-section-number">5.5.4</span> Sonar</a></li>
                <li><a href="#reporting"><span class="toc-section-number">5.5.5</span> Reporting</a></li>
                <li><a href="#selenium"><span class="toc-section-number">5.5.6</span> Selenium</a></li>
                <li><a href="#quality-dashboard"><span class="toc-section-number">5.5.7</span> Quality-dashboard</a></li>
                <li><a href="#jenkins"><span class="toc-section-number">5.5.8</span> Jenkins</a></li>
                <li><a href="#application"><span class="toc-section-number">5.5.9</span> Application</a></li>
                </ul></li>
                </ul></li>
                <li><a href="#stages-of-continuous-delivery"><span class="toc-section-number">6</span> Stages of Continuous Delivery</a><ul>
                <li><a href="#stage-1-ci-in-a-shared-environment"><span class="toc-section-number">6.1</span> Stage 1: CI in a shared environment</a></li>
                <li><a href="#stage-2-automated-cd-in-a-distributed-environment"><span class="toc-section-number">6.2</span> Stage 2: Automated CD in a distributed environment</a></li>
                <li><a href="#stage-3-----next-evolution.."><span class="toc-section-number">6.3</span> Stage 3: --- next evolution..</a></li>
                <li><a href="#initial-situation"><span class="toc-section-number">6.4</span> Initial situation</a></li>
                </ul></li>
                <li><a href="#references">References</a></li>
                </ul>
            </div>
                                <!--
This is the Latex-heavy title page.
People outside UCL may want to remove the header logo
and add the centred logo
-->

<!-- This page is for an official declaration. -->

<p>  </p>
<h1 id="abstract" class="unnumbered">Abstract</h1>
<p>tbd.</p>
<p> </p>
<h1 id="acknowledgements" class="unnumbered">Acknowledgements</h1>
<p>tbd</p>
<!-- Use the \newpage command to force a new page -->

<p></p>
<p></p>

<h1 id="introduction"><span class="header-section-number">1</span> Introduction</h1>
<p>tbd.</p>
<h1 id="literature-review"><span class="header-section-number">2</span> Literature review</h1>
<!--
After the introductory chapter, it seems fairly common to
include a chapter that reviews the literature and
introduces methodology used throughout the thesis.
-->
<h2 id="introduction-1"><span class="header-section-number">2.1</span> Introduction</h2>
<p>tbd.</p>
<h2 id="tools"><span class="header-section-number">2.2</span> Tools</h2>
<h2 id="process"><span class="header-section-number">2.3</span> Process</h2>
<h2 id="people"><span class="header-section-number">2.4</span> People</h2>
<h2 id="methodoloy"><span class="header-section-number">2.5</span> Methodoloy</h2>
<h1 id="the-development-organization"><span class="header-section-number">3</span> The development organization</h1>
<p>In order to understand the problems at the organization it is important to have a deeper understanding of the development organization's structure. The organization is a semi-governmental IT project organization who's mission is to help other (semi-)governmental organizations with IT project management and the realization of projects. They lead by example and help the customer to shape their project according to agile principles. In this thesis we are only concerned with the department responsible for software project realization. Within the Software Delivery (SD) department project teams build software in an agile way. Because some customers are still used to work according to a waterfall approach the department plays an important role in guiding customers. The SD project team helps the customer getting familiar with Agile/Scrum principles in order for them to steer and make decisions about importance of tasks. Before a project ends up at SD it usually follows a pre-development process in which some architectural decisions are already made. This is mostly because governments have to apply to standards and regulations. Usually the software realization team is not involved in this process since the team is not yet in existence. This procedure as described here may vary per project and customer, but it usually applies. When the realization team is formed most of the fundamental decisions have already been taken.</p>
<p>To be able to quickly react to customer needs the development organization relies heavily on external hiring for the duration of a project. Within SD all project members are externals. This gives the organization the ability to quickly scale up or down depending on the number of active projects. However, it also implies that knowledge is easily lost. The organization tries to move people between projects as much as possible in order to retain them. In order to move people more easily between projects and bring new people up to speed more quickly the development phase is standardized within the department as much as possible. The standardization is targeted at process, tools and development frameworks and languages. This standardization is something that can change over time and is defined by SD itself. It is possible for a single project to differentiate from the standard following the &quot;comply or explain&quot;-principle.</p>
<p>The standardized process is based on Continuous Integration and Delivery (CI/CD) principles. In the next chapter we will take a closer look at the CI/CD process.</p>
<h1 id="what-is-continuous-delivery"><span class="header-section-number">4</span> What is Continuous Delivery</h1>
<p>In this chapter I will discuss what people generally understand by the term Continuous Delivery.</p>
<h2 id="continuous-integration"><span class="header-section-number">4.1</span> Continuous Integration</h2>
<p>Continuous Delivery is the natural evolution of Continuous Integration (CI). Practicing Continuous Integration is an absolute necessity before you can start with Continuous Delivery.</p>
<p>CI focuses on integrating different software branches into a main line. This generally occurs when developers make changes to the main line in their development environments.</p>
<p>To do CI one needs at least the following systems:</p>
<ol style="list-style-type: decimal">
<li>Revision Control System</li>
<li>Continuous Integration Server</li>
</ol>
<p>Figure  depicts the dependency relationship between the CI systems.</p>
<div class="figure">
<img src="figures/arch-overview-CI.png" alt="Overview Continuous Integration " />
<p class="caption">Overview Continuous Integration </p>
</div>
<h3 id="revision-control-system"><span class="header-section-number">4.1.1</span> Revision Control System</h3>
<p>The RCS covers the integration of code branches into a main line.</p>
<h3 id="continuous-integration-server"><span class="header-section-number">4.1.2</span> Continuous Integration Server</h3>
<p>A CI-server, sometimes referred to as the build server, automatically performs the build process when a code branch is integrated into the main line. This ensures that the software in the main line can still be build according to predefined rules. Furthermore it ensures that the change doesn't depend on development specific environments, reducing the 'it builds on my machine'-problem. Preferably the CI-server also executes tests to ensure that previous functionality is still intact.</p>
<h2 id="continuous-delivery"><span class="header-section-number">4.2</span> Continuous Delivery</h2>
<p>Since Continuous Delivery (CD) builds on top of CI it reuses its systems.</p>
<h1 id="continuous-delivery-at-the-development-organization"><span class="header-section-number">5</span> Continuous Delivery at the Development Organization</h1>
<p>In this chapter I describe the technical setup and infrastructure of the CI/CD environment at the development organization. First I describe the previous situation and then the current situation. I do this by describing a set of common scenario's.</p>
<h2 id="scenarios"><span class="header-section-number">5.1</span> Scenario's</h2>
<h3 id="scenario-1-a-new-project"><span class="header-section-number">5.1.1</span> Scenario 1: A new project</h3>
<p>When a new project is taken on by the development organization a technical infrastructure needs to be setup in order to accomodate the development process. It includes the setup of a ci/cd-pipeline, access-management and creation of serveral (virtual) deployment servers.</p>
<h3 id="scenario-use-a-new-version-of-java"><span class="header-section-number">5.1.2</span> Scenario: Use a new version of Java</h3>
<p>...</p>
<h3 id="scenario-upgrade-the-application-server"><span class="header-section-number">5.1.3</span> Scenario: Upgrade the application server</h3>
<p>...</p>
<h3 id="scenario-application-instance-per-tester"><span class="header-section-number">5.1.4</span> Scenario: Application instance per tester</h3>
<p>...</p>
<h3 id="scenario-parallel-frontend-test-execution"><span class="header-section-number">5.1.5</span> Scenario: Parallel frontend test execution</h3>
<p>...</p>
<h3 id="scenario-install-a-plugin-in-jenkins-ci"><span class="header-section-number">5.1.6</span> Scenario: Install a plugin in Jenkins CI</h3>
<p>...</p>
<h3 id="scenario-upgrade-jenkins-ci"><span class="header-section-number">5.1.7</span> Scenario: Upgrade Jenkins CI</h3>
<p>...</p>
<h3 id="scenario-switch-to-another-tool"><span class="header-section-number">5.1.8</span> Scenario: Switch to another tool</h3>
<p>...</p>
<h2 id="ci-in-a-shared-environment"><span class="header-section-number">5.2</span> CI in a shared environment</h2>
<p>This paragraph describes the previous CI/CD landscape at the development organization.</p>
<h3 id="the-situation"><span class="header-section-number">5.2.1</span> The situation</h3>
<p>The systems needed for CI/CD are managed by an Ops team. All projects use a set of shared services. Figure  depicts the relationship between the Ops team and the development teams. The shared services are:</p>
<ul>
<li>Subversion</li>
<li>Jenkins CI</li>
<li>Jenkins build servers</li>
<li>SonarQube</li>
<li>Nexus</li>
<li>Jira</li>
</ul>
<div class="figure">
<img src="figures/teams-in-shared-environment2.png" alt="Relationship between Ops and Development teams in a shared environment " />
<p class="caption">Relationship between Ops and Development teams in a shared environment </p>
</div>
<p>Besides the shared services each project would be assigned one or more deployment servers. The deployment servers are managed by the Ops team.</p>
<p>The next chapter describes common scenario's that occur in a CI/CD environment on request of the development team. These scenario's describe the impact on the development team.</p>
<h3 id="scenario-a-new-project"><span class="header-section-number">5.2.2</span> Scenario: A new project</h3>
<h3 id="scenario-use-a-new-version-of-java-1"><span class="header-section-number">5.2.3</span> Scenario: Use a new version of Java</h3>
<p>...</p>
<h3 id="scenario-upgrade-the-application-server-1"><span class="header-section-number">5.2.4</span> Scenario: Upgrade the application server</h3>
<p>...</p>
<h3 id="scenario-application-instance-per-tester-1"><span class="header-section-number">5.2.5</span> Scenario: Application instance per tester</h3>
<p>...</p>
<h3 id="scenario-parallel-frontend-test-execution-1"><span class="header-section-number">5.2.6</span> Scenario: Parallel frontend test execution</h3>
<p>...</p>
<h3 id="scenario-install-a-plugin-in-jenkins-ci-1"><span class="header-section-number">5.2.7</span> Scenario: Install a plugin in Jenkins CI</h3>
<p>...</p>
<h3 id="scenario-upgrade-jenkins-ci-1"><span class="header-section-number">5.2.8</span> Scenario: Upgrade Jenkins CI</h3>
<p>...</p>
<h3 id="scenario-switch-to-another-tool-1"><span class="header-section-number">5.2.9</span> Scenario: Switch to another tool</h3>
<p>...</p>
<h2 id="ci-in-a-distributed-environment"><span class="header-section-number">5.3</span> CI in a distributed environment</h2>
<p>This paragraph describes the current CI/CD landscape at the development organization.</p>
<h3 id="the-situation-1"><span class="header-section-number">5.3.1</span> The situation</h3>
<p>Instead of managing the systems needed for CI/CD the Ops team manages a distributed environment in which teams are able to deploy applications at will and on demand.</p>
<div class="figure">
<img src="figures/teams-in-distributed-environment.png" alt="Relationship between Ops and Development teams in a distributed environment " />
<p class="caption">Relationship between Ops and Development teams in a distributed environment </p>
</div>
<h3 id="scenario-a-new-project-1"><span class="header-section-number">5.3.2</span> Scenario: A new project</h3>
<p>...</p>
<h3 id="scenario-use-a-new-version-of-java-2"><span class="header-section-number">5.3.3</span> Scenario: Use a new version of Java</h3>
<p>...</p>
<h3 id="scenario-upgrade-the-application-server-2"><span class="header-section-number">5.3.4</span> Scenario: Upgrade the application server</h3>
<p>...</p>
<h3 id="scenario-application-instance-per-tester-2"><span class="header-section-number">5.3.5</span> Scenario: Application instance per tester</h3>
<p>...</p>
<h3 id="scenario-parallel-frontend-test-execution-2"><span class="header-section-number">5.3.6</span> Scenario: Parallel frontend test execution</h3>
<p>...</p>
<h3 id="scenario-install-a-plugin-in-jenkins-ci-2"><span class="header-section-number">5.3.7</span> Scenario: Install a plugin in Jenkins CI</h3>
<p>...</p>
<h3 id="scenario-upgrade-jenkins-ci-2"><span class="header-section-number">5.3.8</span> Scenario: Upgrade Jenkins CI</h3>
<p>...</p>
<h3 id="scenario-switch-to-another-tool-2"><span class="header-section-number">5.3.9</span> Scenario: Switch to another tool</h3>
<p>...</p>
<h2 id="a-new-project"><span class="header-section-number">5.4</span> A new project</h2>
<p>This paragraph conceptually describes what happens when a new project is embedded within the development organization. Besides organizational arrangements a technical infrastructure is setup to accommodate the development of the software application.</p>
<p>The following systems are employed:</p>
<ul>
<li>Gitlab</li>
<li>Jenkins CI</li>
<li>Jenkins build servers</li>
<li>SonarQube</li>
<li>Nexus</li>
<li>Mediawiki</li>
<li>Deployment servers</li>
<li>Jira</li>
<li>Releasemanager</li>
<li>Quality dashboard</li>
<li>Test reporting</li>
</ul>
<p>The next paragraphs talk about the tasks that happen initially and tasks that recur more frequently.</p>
<h3 id="infrastructure-setup"><span class="header-section-number">5.4.1</span> Infrastructure setup</h3>
<p>Initially every system used needs to be installed onto a target server. Depending on how you choose to do the installation, this might take some time.</p>
<h4 id="gitlab"><span class="header-section-number">5.4.1.1</span> Gitlab</h4>
<p>Gitlab is used as a revision control server.</p>
<ol style="list-style-type: decimal">
<li>Install Gitlab</li>
<li>Configure authentication mechanism (LDAP)</li>
<li>Set roles and permissions for users</li>
</ol>
<h4 id="jenkins-and-build-servers"><span class="header-section-number">5.4.1.2</span> Jenkins and build servers</h4>
<p>Depending on the project one or more build servers are needed. A build server has specific tooling on-board to be able to build the application. The following list details the installation steps.</p>
<ol style="list-style-type: decimal">
<li>Install Jenkins CI</li>
<li>Install one or more Jenkins build servers</li>
<li>Install specific tooling on the build server</li>
<li>Configure the build server in the main Jenkins server</li>
<li>Configure authentication mechanism (LDAP)</li>
</ol>
<h4 id="sonarqube"><span class="header-section-number">5.4.1.3</span> SonarQube</h4>
<p>SonarQube is used to continuously monitor the quality of the source code.</p>
<ol style="list-style-type: decimal">
<li>Install SonarQube</li>
<li>Configure authentication mechanism (LDAP)</li>
</ol>
<h4 id="nexus"><span class="header-section-number">5.4.1.4</span> Nexus</h4>
<p>Nexus is used to archive and distribute software artifacts.</p>
<ol style="list-style-type: decimal">
<li>Install Nexus</li>
<li>Configure authentication mechanism (LDAP)</li>
</ol>
<h4 id="mediawiki"><span class="header-section-number">5.4.1.5</span> Mediawiki</h4>
<p>Mediawiki is used as a team collaboration tool.</p>
<ol style="list-style-type: decimal">
<li>Install Mediawiki</li>
<li>Configure authentication mechanism (LDAP)</li>
</ol>
<h4 id="deployment-servers"><span class="header-section-number">5.4.1.6</span> Deployment servers</h4>
<p>For the purpose of deploying the application in a production like environment a deployment landscape has to be setup. Depending on the application this can be as simple as a single server, or as complex as a clustered setup of a Java application server with a corresponding complex database setup.</p>
<h4 id="jira"><span class="header-section-number">5.4.1.7</span> Jira</h4>
<p>Jira is readily available within the organization and doesn't need to be setup. However, it needs to be configured to accommodate the new project.</p>
<h3 id="project-setup"><span class="header-section-number">5.4.2</span> Project setup</h3>
<p>After the infrastructure is setup the project team adds configuration to the tools to be able to build and deploy their application.</p>
<ol style="list-style-type: decimal">
<li>A user for Jenkins needs to be created in Gitlab and configured in Jenkins so that Jenkins can checkout copies of the source code.</li>
<li>Code repositories are created in Gitlab for the corresponding applications.</li>
<li>Optional, import existing source code into Gitlab.</li>
<li>Configure jobs in Jenkins to build, test and deploy (for every application)</li>
<li>Configure the location of the SonarQube API in Jenkins</li>
<li></li>
</ol>
<h3 id="recurring-tasks"><span class="header-section-number">5.4.3</span> Recurring tasks</h3>
<h2 id="configuring-the-cd-pipeline"><span class="header-section-number">5.5</span> Configuring the CD-pipeline</h2>
<h3 id="nexus-1"><span class="header-section-number">5.5.1</span> Nexus</h3>
<h4 id="add-nexus-to-docker-dashboard."><span class="header-section-number">5.5.1.1</span> Add nexus to Docker dashboard.</h4>
<p>Go to Docker dashboard &gt; Apps &gt; New App. Enter the following app definition:</p>
<pre><code>name: nexus
version: 2.13.0-01
description: Sonatype Nexus repository manager.
pic: https://avatars0.githubusercontent.com/u/44938?v=3&amp;s=400

#login with admin / admin123

#tags:infra

www:
 image: sonatype/nexus:2.13.0-01
 user: root
 volumes:
 - /sonatype-work</code></pre>
<p>Click Save changes</p>
<p>Start app nexus</p>
<h4 id="configure-security"><span class="header-section-number">5.5.1.2</span> Configure security</h4>
<p>Go to Nexus &gt; Log in with username admin and password admin123</p>
<p>Go to Security &gt; Users Select user anonymous Click Add, select Repo: All Repositories (Full Control), click OK Click Save</p>
<h3 id="gitlab-1"><span class="header-section-number">5.5.2</span> Gitlab</h3>
<h4 id="add-gitlab-to-docker-dashboard"><span class="header-section-number">5.5.2.1</span> Add gitlab to Docker dashboard</h4>
<p>Go to Docker dashboard &gt; Apps &gt; New App Enter the following app definition:</p>
<pre><code>name: gitlab
version: 8.6.1

#tags:infra

www:
  image: www.docker-registry.isd.ictu:5000/gitlab-ce:8.6.1
  volumes:
    - /etc/gitlab
    - /var/log/gitlab
    - /var/opt/gitlab</code></pre>
<p>Click Save changes</p>
<p>Start app gitlab</p>
<h4 id="create-root-account"><span class="header-section-number">5.5.2.2</span> Create root account</h4>
<p>Go to Gitlab New password: root@123! Confirm new password: root@123! Click Change your password</p>
<h4 id="create-usergroup-and-users"><span class="header-section-number">5.5.2.3</span> Create usergroup and user(s)</h4>
<p>Go to Gitlab &gt; Log in with username root and password root123!</p>
<p>Go to Admin Area &gt; Groups &gt; New Group Group path: test-group Visibility Level: Private Click Create Group</p>
<p>Go to Admin Area &gt; Users &gt; New User Name: <name> Username: <username> Email: <email> Click Create user Click Edit Password: user@123! Password confirmation: user@123! Click Save Changes</p>
<p>Go to Admin Area &gt; Groups &gt; test-group Add user <username> to group with role Developer</p>
<h4 id="create-jenkins-user"><span class="header-section-number">5.5.2.4</span> Create jenkins user</h4>
<p>Go to Gitlab &gt; Log in with username root and password root123!</p>
<p>Go to Admin Area &gt; Users &gt; New User Name: Jenkins Username: jenkins Email: noreply@jenkins.ictu Click Create user Click Edit Password: jenkins@123! Password confirmation: jenkins@123! Click Save Changes</p>
<p>Go to Admin Area &gt; Groups &gt; test-group Add user jenkins to group with role Master</p>
<h4 id="import-jenkins-ssh-key"><span class="header-section-number">5.5.2.5</span> Import jenkins SSH key</h4>
<p>Go to Gitlab &gt; Log in with username jenkins and password jenkins123!</p>
<p>Go to Profile Settings &gt; SSH Keys</p>
<p>Key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCrSFSIYRJjTbWqYuU6cGQ0aNaewMQ/m0k3m/MA7mNb2LEGNb0CQAoJDwwuPiftfj9cP6UrTlFqKGRKuLlAD7qrf9kQOSzgfwDJ7lSYY8QqMP4U1CuL5IuMV/Zwg0npA9SnPpD8KcrxMQgKZ62F12xoR+vXLMSgMnTwu7olZVQphdMcvu2H5ugV4kBNyyRfKSeDDatsYKnwVirhLBRMtdFTLqo2wFe8dMM/2mZIiGl5KXg0gCXpD2VEFiVCINARGLsdh9nzn2gxLoagIbXzxWjGRo0tu69GuS2YqNj7GX5QJMpTP4UAWPvymx1TiJqmWAatejdfhYeJWoTLA6dnxaFV noreply@jenkins.ictu</p>
<p>Click Add key</p>
<h4 id="create-project-repo"><span class="header-section-number">5.5.2.6</span> Create project repo</h4>
<p>Go to Gitlab &gt; Log in with username root and password root123!</p>
<p>Go to Admin Area &gt; Projects &gt; New Project Project path: http://www.gitlab-test.digilevering.ictu/test-group/test-project Visibility: Private Click Create project</p>
<p>Go to Admin Area &gt; Projects &gt; test-group/test-project &gt; Edit &gt; Protected Branches In table Already Protected select Developers can push for branch master</p>
<h3 id="docker-registry"><span class="header-section-number">5.5.3</span> Docker Registry</h3>
<h4 id="add-docker-registry-to-docker-dashboard"><span class="header-section-number">5.5.3.1</span> Add docker-registry to Docker dashboard</h4>
<p>Go to Docker dashboard &gt; Apps &gt; New App Enter the following app definition:</p>
<pre><code>name: docker-registry
version: 2.1.1

#tags:infra

www:
 image: distribution/registry:2.1.1
 mem_limit: 2048m
 environment:
 - REGISTRY_VERSION=0.1
 - REGISTRY_LOG_FIELDS_SERVICE=registry
 - REGISTRY_LOG_FIELDS_ENVIRONMENT=production
 - REGISTRY_STORAGE_CACHE_BLOBDESCRIPTOR=inmemory
 - REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY=/docker-registry/
 - &#39;REGISTRY_HTTP_ADDR=:5000&#39;
 - REGISTRY_HTTP_HEADERS_X-CONTENT-TYPE-OPTIONS=[nosniff]
 - REGISTRY_HEALTH_STORAGEDRIVER_ENABLED=true
 - REGISTRY_HEALTH_STORAGEDRIVER_INTERVAL=10s
 - REGISTRY_HEALTH_STORAGEDRIVER_THRESHOLD=3
 volumes:
 - /docker-registry</code></pre>
<p>Click Save changes Start app docker-registry</p>
<h3 id="sonar"><span class="header-section-number">5.5.4</span> Sonar</h3>
<h4 id="add-sonar-to-docker-dashboard"><span class="header-section-number">5.5.4.1</span> Add sonar to Docker dashboard</h4>
<p>Go to Docker dashboard &gt; Apps &gt; New App Enter the following app definition:</p>
<pre><code>name: sonar
version: 4.5.7
description: Manage code quality
pic: http://docs.sonarqube.org/download/attachments/6951171/SONAR?version=1&amp;modificationDate=1452514709000&amp;api=v2

#tags: infra

#login with admin/admin

www:
  image: sonarqube:4.5.7
  environment:
    - SONARQUBE_JDBC_USERNAME=sonar
    - SONARQUBE_JDBC_PASSWORD=sonar
    - &quot;SONARQUBE_JDBC_URL=jdbc:mysql://db/sonar?useUnicode=true&amp;amp;characterEncoding=utf8&quot;
  volumes:
    - /opt/sonarqube/extensions/downloads
    - /opt/sonarqube/extensions/plugins
  links:
    - db
  enable_ssh: true

db:
  image: mysql:5.6
  environment:
    - MYSQL_ROOT_PASSWORD=root
    - MYSQL_DATABASE=sonar
    - MYSQL_USER=sonar
    - MYSQL_PASSWORD=sonar
  volumes:
    - /var/lib/mysql</code></pre>
<p>Click Save changes</p>
<p>Start app sonar</p>
<h4 id="install-plugins"><span class="header-section-number">5.5.4.2</span> Install plugins</h4>
<p>Open terminal</p>
<pre><code>cd /path/to/dir/with/sonar/plugins
scp sonar-checkstyle-plugin-2.4.jar sonar-findbugs-plugin-3.3.jar sonar-java-plugin-3.14.jar sonar-pmd-plugin-2.5.jar sonar-web-plugin-2.4.jar www.sonar.&lt;your-project&gt;.ictu:~
ssh -p 22 www.sonar.&lt;your-project&gt;.ictu
cd /opt/sonarqube/extensions/plugins
rm *
cp ~/* .
exit</code></pre>
<p>Go to Docker dashboard &gt; Apps Restart sonar app</p>
<h4 id="add-quality-profiles"><span class="header-section-number">5.5.4.3</span> Add quality profiles</h4>
<p>Go to Sonar &gt; Login with username admin and password admin</p>
<p>Go to Quality Profiles Click Restore Profile Select ICTU Java profile to import and click Restore Click Restore Profile Select ICTU Web profile to import and click Restore</p>
<h3 id="reporting"><span class="header-section-number">5.5.5</span> Reporting</h3>
<h4 id="create-jira-filter"><span class="header-section-number">5.5.5.1</span> Create Jira filter</h4>
<p>Go to Jira &gt; Log in with username isf-reporter and password Cf1NzS8INfJUB5wDQHI9</p>
<p>Go to Issues &gt; Search for issues If the basic search is shown instead of the advanced search, click Advanced Enter the following query:</p>
<p>project = <Jira project name> AND type in (Story, &quot;Logical Test Case&quot;, Systeemfunctie) ORDER BY type</p>
<p>Click Save as Filter name: <name> Click Submit</p>
<p>Write down the filter-id of the filter (it’s displayed in the URL, https://jira.ictu-sd.nl/jira/issues/?filter=<filter-id>)</p>
<h4 id="add-reporting-to-docker-dashboard"><span class="header-section-number">5.5.5.2</span> Add reporting to Docker dashboard</h4>
<p>Go to Docker dashboard &gt; Apps &gt; New App Enter the following app definition:</p>
<pre><code>name: reporting
version: 2.2.2
description: ISD quality reporting
pic: http://www.timetell.nl/wp-content/uploads/2015/03/logo-ictu.png

#tags: autorun

www:
  image: docker-registry.isd.ictu:5000/birt-reports:2.1.65
  mem_limit: 2g
  environment:
    - REPORT_USER=reporter
    - REPORT_PASSWORD=reporter007
    - &#39;REPORT_URL=jdbc:postgresql://db:5432/birt&#39;
    - REPORT_USER_RM=reporter
    - REPORT_PASSWORD_RM=reporter007
    - &#39;REPORT_URL_RM=jdbc:postgresql://db:5432/birt&#39;
  links:
    - db

importer:
  image: docker-registry.isd.ictu:5000/birt-jira-importer:2.4.1
  environment:
    - &#39;report_jdbc_url=jdbc:postgresql://db:5432/birt&#39;
    - &#39;jira_filter=filter=&lt;filter-id&gt;&#39;
  links:
    - db

trr:
  image: docker-registry.isd.ictu:5000/birt-test-results-service:2.0.50
  environment:
    - &#39;report_jdbc_url=jdbc:postgresql://db:5432/birt&#39;
  links:
    - db

db:
    image: docker-registry.isd.ictu:5000/birt-database:2.0.37
    volumes:
        - /var/lib/postgresql/data
    environment:
        - POSTGRES_PASSWORD=my-secret-pw
    mem_limit: 2g

rm:
  image: docker-registry.isd.ictu:5000/releasemanager:1.0.36
  environment:
    - DB_DRIVER=pdo_pgsql
    - DB_HOST=db
    - DB_PORT=5432
    - DB_USER=releasemanager
    - DB_PASSWORD=releasemanager007
    - DB_DATABASE=birt
  volumes:
    - /mnt/publish
  links:
    - db</code></pre>
<p>Click Save changes</p>
<p>Start app reporting</p>
<h3 id="selenium"><span class="header-section-number">5.5.6</span> Selenium</h3>
<h4 id="add-selenium-to-docker-dashboard"><span class="header-section-number">5.5.6.1</span> Add selenium to Docker dashboard</h4>
<p>Go to Docker dashboard &gt; Apps &gt; New App Enter the following app definition:</p>
<pre><code>name: selenium
version: official

#tags: autorun

server:
 image: selenium/standalone-firefox</code></pre>
<p>Click Save changes</p>
<p>Start app selenium</p>
<h3 id="quality-dashboard"><span class="header-section-number">5.5.7</span> Quality-dashboard</h3>
<p><strong>TODO! detail how to setup the quality tracking and monitoring system</strong> See http://wiki.isd.org/index.php/HandleidingKwaliteitssysteem &gt; Opzet van een kwaliteitsdashboard</p>
<h3 id="jenkins"><span class="header-section-number">5.5.8</span> Jenkins</h3>
<h4 id="add-jenkins-to-docker-dashboard"><span class="header-section-number">5.5.8.1</span> Add jenkins to Docker dashboard</h4>
<p>Go to Docker dashboard &gt; Apps &gt; New App Enter the following app definition:</p>
<pre><code>name: jenkins
version: 1.651.2
description: An extendable open source automation server
pic: http://rabellamy.github.io/DevOps-Sunset/images/jenkins.png


#tags: autorun

www:
  image: jenkins:1.651.2
  volumes:
    - /var/jenkins_home
  environment:
    - &quot;JAVA_OPTS=-Duser.timezone=Europe/Amsterdam&quot;
  links:
    - jnlp
  enable_ssh: true

jnlp:
  image: tehranian/dind-jenkins-slave:latest
  environment:
    - &quot;DOCKER_DAEMON_ARGS=-H unix:///var/run/docker.sock -H tcp://0.0.0.0:2375 --insecure-registry 10.25.0.0/16&quot;
    - &quot;JAVA_OPTS=-Duser.timezone=Europe/Amsterdam&quot;
  mem_limit: 2g
  privileged: true
  enable_ssh: true</code></pre>
<p>Click Save changes Start app jenkins</p>
<h4 id="install-plugins-1"><span class="header-section-number">5.5.8.2</span> Install plugins</h4>
<p>Go to Jenkins &gt; Manage Jenkins &gt; Manage Plugins &gt; Available</p>
<p>Select the following plugins:</p>
<p>Maven Release Plug-in Plug-in (0.14.0) Git plugin (3.0.0) SonarQube Plugin (2.4.4) OWASP Dependency-Check Plugin (1.4.3) Git client plugin (used by Git plugin) SCM API Plugin (used by Git plugin) Conditional BuildStep + Run Condition Plugin? Parameterized Trigger plugin? Static Analysis Utilities (used by OWASP Dependency-Check Plugin) Token Macro Plugin (used by OWASP Dependency-Check Plugin) Workspace Cleanup Plugin? Build Pipeline Plugin?</p>
<h4 id="configure-system"><span class="header-section-number">5.5.8.3</span> Configure system</h4>
<p>Go to Jenkins &gt; Manage Jenkins &gt; Configure System</p>
<p>SonarQube servers Click Add SonarQube Name: SonarQube Server URL: http://www.sonar.<your-project>.ictu:9000 Server version: 5.1 or lower Click Advanced Version of sonar-maven-plugin: 3.0.1 Database URL: jdbc:mysql://db.sonar.<your-project>.ictu:3306/sonar Database login: sonar Database password: sonar</p>
<p>Git plugin Global Config user.name Value: jenkins Global Config user.email Value: noreply@jenkins.ictu</p>
<p>Maven Click Add Maven Name: Maven 3.3.9 Version: 3.3.9</p>
<p>E-mail Notification SMTP server: smtp.isd.org</p>
<p>Click Save</p>
<h4 id="add-gitlab-user"><span class="header-section-number">5.5.8.4</span> Add gitlab user</h4>
<p>Go to Jenkins &gt; Credentials &gt; (global) &gt; Add credentials Kind: SSH username with private key Scope: Global Username: jenkins Private key: Enter directly Key:</p>
<p>-----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEAq0hUiGESY021qmLlOnBkNGjWnsDEP5tJN5vzAO5jW9ixBjW9 AkAKCQ8MLj4n7X4/XD+lK05RaihkSri5QA+6q3/ZEDks4H8Aye5UmGPEKjD+FNQr i+SLjFf2cINJ6QPUpz6Q/CnK8TEICmethddsaEfr1yzEoDJ08Lu6JWVUKYXTHL7t h+boFeJATcskXykngw2rbGCp8FYq4SwUTLXRUy6qNsBXvHTDP9pmSIhpeSl4NIAl 6Q9lRBYlQiDQERi7HYfZ859oMS6GoCG188VoxkaNLbuvRrktmKjY+xl+UCTKUz+F AFj78psdU4iaplgGrXo3X4WHiVqEywOnZ8WhVQIDAQABAoIBAHSw9W5oe+eNpMut TrBuq8YM+tLzT4BqIgqxw2+J+cU0Lv6lE9z5lhyv1MOYcwlZLn+BmNyVIeBqHlHN 4d+kF7AJjO+BlHJp9DaemaGsrpN0B1ZXakeHcA8wSmRC/dKzWmiKtqolKu8BUZIN Kmn55xBwl1tkU500YvkzXFFn5FvYg7NzvdgajfrywgU6GIm6miGWzkb0F5MRnXtb hhx32sSu9H87Fu54DpMIWQzzpqJuPPLL8SxZKheuceYcV/tXT6IG5WnSl3KnNVYX cSLRN4miN6dVlX9GIdwsAxdrqexm/OLw/J5Mgf2SaIKslMNoGciojtaQaLt/ofde UWa0lWECgYEA3kg9Tv8/iIWIzIYvgC8D/ZyjyExlcX6jVSrbFCjZyYhDqxA2LPSa SQwcHesLk4c4GS1in47Mo/otxdPYnmu2o0Ob4hoICGLEJiWdiI7ljJ8CWtsjNGts GhCsv3guTT1WnfOpWbsaKDodinEa2YNekxAjh/9EQZR4x6Y9EQ61C8kCgYEAxUOm W8orY6M4YYeb1nA9izW1twjrK0jZ6u07n3ooAVJx5WNr69/ATZx/Lw4ou1RGZ3qb q4/iol5DwenxcaETV5h5q/170pvnhkLoRIWd+Rd+oEu+GtYwVrLd/ybJZswJMYc/ KIRHrw3DpM0yVxrilENe3TQ8k2O3VJRsucmHly0CgYEA2Jq+m5dh2vB9MQhli1zF X8LfWxUPGXzVPu4HFGsGZzvQ7QZcNIybOCmD0Ke13So8QVSXsXJe+j+VkRxyD1ZZ YFlGsxq4zysnhyDKlULib5iXm9/FO5Sef/vVyrMbM4tdN4g0c8s+nwqatMio6GL6 qwZkCWd3pQxAchUNluylAfkCgYArkDIH6VDFs0D7QOBobecZfCYCIuUUbQU6/WMC aA63pAZlGxy1PXeRbDMmKCFUpVra9Ve1fpQVOW4LP+fDKUhFOvX7xoH209lAbDwx DbUCUm7zZWa5NH3+V4fxFha6LesF1hFbmELgZNDE70/jrptFFM+5WBTck9PjyNdt /BSGjQKBgDS8bI/B6uMos882AG4eOcUBEVdaTaOIBqJEM0s5u8PPNBaXsx4kfH62 9vnfrX3tf8fj3UgrIsqEg/N2Pze2ktj8ikqz4cIJqX0fHHvEYC+FvqDcdit14Cv9 q0lAlP1AXSP4kry7SguwMTlewfcMUXxwTEIs0PXujqx8uTBLnUBY -----END RSA PRIVATE KEY-----</p>
<p>Description: gitlab user</p>
<p>Click OK</p>
<h4 id="add-ssh-user-to-connect-to-dind-slave"><span class="header-section-number">5.5.8.5</span> Add SSH user to connect to dind-slave</h4>
<p>Go to Jenkins &gt; Credentials &gt; (global) &gt; Add credentials</p>
<p>Kind: Username with password Scope: Global Username: jenkins Password: jenkins Description: SSH user to connect to dind-slave</p>
<p>Click OK</p>
<h4 id="add-dind-slave"><span class="header-section-number">5.5.8.6</span> Add dind-slave</h4>
<p>Go to Jenkins &gt; Manage Jenkins &gt; Manage Nodes &gt; New Node</p>
<p>Node name: dind-slave Select Dumb Slave Click OK</p>
<p>number of executors: 2 Remote root directory: /tmp Labels: docker Usage: Only build jobs with label restrictions matching this node Launch method: Launch slave agents on Unix machines via SSH Host: jnlp.jenkins.<your-project>.ictu Credentials: jenkins (SSH user to connect to dind-slave)</p>
<p>Click Save</p>
<h4 id="create-job-sonar-app"><span class="header-section-number">5.5.8.7</span> Create job sonar-app</h4>
<p>Go to Jenkins &gt; New item</p>
<p>Item name: sonar-app Select Maven project</p>
<p>Click OK Configure job sonar-app Go to Jenkins &gt; sonar-app &gt; Configure</p>
<p>Select Discard old builds Max # of builds to keep: 5</p>
<p>Source Code Management Select Git Repository URL: git@www.gitlab.<your-project>.ictu:test-group/test-project.git Credentials: jenkins (gitlab user)</p>
<p>Build Triggers Unselect all options</p>
<p>Build Root POM: testapp/pom.xml Goals and options: clean install -DskipTests</p>
<p>Post-build Actions Click Add post-build action, select SonarQube analysis with Maven</p>
<p>Click Save</p>
<h4 id="create-job-dependency-check-app"><span class="header-section-number">5.5.8.8</span> Create job dependency-check-app</h4>
<p>Go to Jenkins &gt; New item</p>
<p>Item name: dependency-check-app Select Maven project</p>
<p>Click OK Configure job dependency-check-app Go to Jenkins &gt; dependency-check-app &gt; Configure</p>
<p>Select Discard old builds Max # of builds to keep: 5</p>
<p>Source Code Management Select Git Repository URL: git@www.gitlab.<your-project>.ictu:test-group/test-project.git Credentials: jenkins (gitlab user)</p>
<p>Build Triggers Unselect all options</p>
<p>Build Root POM: testapp/pom.xml Goals and options: clean install -DskipTests</p>
<p>Post Steps Select Run regardless of build resultaat Click Add post-build step, select InvokeOWASP Dependency-Check analysis Click Advanced Select Generate optional HTML reports</p>
<p>Post-build Actions Click Add post-build action, select Publish OWASP Dependency-Check analysis results</p>
<p>Click Save</p>
<h4 id="create-job-build-app"><span class="header-section-number">5.5.8.9</span> Create job build-app</h4>
<p>Go to Jenkins &gt; New item</p>
<p>Item name: build-app Select Maven project</p>
<p>Click OK</p>
<h4 id="configure-job-build-app"><span class="header-section-number">5.5.8.10</span> Configure job build-app</h4>
<p>Go to Jenkins &gt; build-app &gt; Configure</p>
<p>Select Discard old builds Max # of builds to keep: 5</p>
<p>Source Code Management Select Git Repository URL: git@www.gitlab.<your-project>.ictu:test-group/test-project.git Credentials: jenkins (gitlab user) Additional Behaviours Click Add, select Check out to specific local branch Branch name: master</p>
<p>Build Triggers Select Poll SCM Schedule: H/5 * * * *</p>
<p>Build environment Select Maven release build Default versioning mode: None</p>
<p>Build Root POM: testapp/pom.xml Goals and options: clean install</p>
<p>Click Save</p>
<h4 id="create-job-build-image"><span class="header-section-number">5.5.8.11</span> Create job build-image</h4>
<p>Go to Jenkins &gt; New item</p>
<p>Item name: build-image Select Freestyle project</p>
<p>Click OK</p>
<h4 id="configure-job-build-image"><span class="header-section-number">5.5.8.12</span> Configure job build-image</h4>
<p>Go to Jenkins &gt; build-image &gt; Configure</p>
<p>Select Discard old builds Max # of builds to keep: 5</p>
<p>Select Restrict where this project can be run Label Expression: docker</p>
<p>Source Code Management Select Git Repository URL: git@www.gitlab.<your-project>.ictu:test-group/test-project.git Credentials: jenkins (gitlab user)</p>
<p>Build Click Add build step, select Execute shell Command:</p>
<p>cd docker ./build.sh</p>
<h4 id="create-job-sonar-art"><span class="header-section-number">5.5.8.13</span> Create job sonar-art</h4>
<p>Go to Jenkins &gt; New item</p>
<p>Item name: sonar-art Select Maven project</p>
<p>Click OK</p>
<h4 id="configure-job-sonar-art"><span class="header-section-number">5.5.8.14</span> Configure job sonar-art</h4>
<p>Go to Jenkins &gt; sonar-art &gt; Configure</p>
<p>Select Discard old builds Max # of builds to keep: 5</p>
<p>Source Code Management Select Git Repository URL: git@www.gitlab.<your-project>.ictu:test-group/test-project.git Credentials: jenkins (gitlab user)</p>
<p>Build Triggers Unselect all options</p>
<p>Build Root POM: testART/pom.xml Goals and options: clean install -DskipTests</p>
<p>Post-build Actions Click Add post-build action, select SonarQube analysis with Maven</p>
<p>Click Save</p>
<h4 id="create-job-build-art"><span class="header-section-number">5.5.8.15</span> Create job build-art</h4>
<p>Go to Jenkins &gt; New item</p>
<p>Item name: build-art Select Maven project</p>
<p>Click OK</p>
<h4 id="configure-job-build-art"><span class="header-section-number">5.5.8.16</span> Configure job build-art</h4>
<p>Go to Jenkins &gt; build-art &gt; Configure</p>
<p>Select Discard old builds Max # of builds to keep: 5</p>
<p>Source Code Management Select Git Repository URL: git@www.gitlab.<your-project>.ictu:test-group/test-project.git Credentials: jenkins (gitlab user) Additional Behaviours Click Add, select Check out to specific local branch Branch name: master</p>
<p>Build environment Select Maven release build Release goals and options: -Dresume=false release:prepare release:perform -Darguments=&quot;-DskipTests&quot; DryRun goals and options: -Dresume=false -DdryRun=true release:prepare -Darguments=&quot;-DskipTests&quot; Default versioning mode: None</p>
<p>Build Root POM: testART/pom.xml Goals and options: clean install -DskipTests</p>
<p>Click Save</p>
<h4 id="create-job-run-art"><span class="header-section-number">5.5.8.17</span> Create job run-art</h4>
<p>Go to Jenkins &gt; New item</p>
<p>Item name: run-art Select Maven project</p>
<p>Click OK</p>
<h4 id="configure-job-run-art"><span class="header-section-number">5.5.8.18</span> Configure job run-art</h4>
<p>Go to Jenkins &gt; run-art &gt; Configure</p>
<p>Select Discard old builds Max # of builds to keep: 5</p>
<p>Select This build is parametrized Click Add Parameter, select String Parameter Name: browserType Default Value: FIREFOX Click Add Parameter, select String Parameter Name: seleniumServerUrl Default Value: http://server.selenium.<your-project>.ictu:4444/wd/hub Click Add Parameter, select String Parameter Name: applicationServerUrl Default Value: http://www.testapp.digilevering.ictu:8080</p>
<p>Source Code Management Select Git Repository URL: git@www.gitlab.<your-project>.ictu:test-group/test-project.git Credentials: jenkins (gitlab user)</p>
<p>Build Root POM: testART/pom.xml Goals and options: -DbrowserType=<span class="math inline"><em>b</em><em>r</em><em>o</em><em>w</em><em>s</em><em>e</em><em>r</em><em>T</em><em>y</em><em>p</em><em>e</em> − <em>D</em><em>s</em><em>e</em><em>l</em><em>e</em><em>n</em><em>i</em><em>u</em><em>m</em><em>S</em><em>e</em><em>r</em><em>v</em><em>e</em><em>r</em><em>U</em><em>r</em><em>l</em>=</span>seleniumServerUrl -DapplicationServerUrl=$applicationServerUrl clean test</p>
<p>Post Steps Select Run only if build succeeds Click Add post-build step, select Execute shell Command:</p>
<pre><code>export \
  URL=&quot;http://trr.reporting.&lt;your-project&gt;.ictu:4567/upload&quot; \
  APP_NAME=&quot;Testapp&quot; \
  APP_VERSION=&quot;SNAPSHOT&quot; \
  TEST_DESCRIPTION=&quot;ART Testapp&quot; \
  TEST_USER=&quot;Jenkins&quot; \
  TEST_VERSION=&quot;Master&quot; \
  TEST_TARGET=&quot;$applicationServerUrl&quot; \
  TEST_PLATFORM=&quot;$browserType&quot; \
  TEST_RUN=&quot;ART&quot; \
  DIR=&quot;testART/target/surefire-reports/junitreports&quot;

# Parallele upload van resultaat
echo &quot;Sending reports in ${DIR}&quot;
echo &quot;${APP_NAME}&quot;
for file in $DIR/\*.xml; do
  [ -f $file ] || continue
  echo $file
done | xargs -I{} --max-procs 0 bash -c &#39;
  curl ${URL} \
    -s \
    -F &quot;junit=@{}&quot; \
    -F &quot;application_name=${APP_NAME}&quot; \
    -F &quot;application_version=${APP_VERSION}&quot; \
    -F &quot;testrun_description=${TEST_DESCRIPTION}&quot; \
    -F &quot;testrun_user=${TEST_USER}&quot; \
    -F &quot;testrun_version=${TEST_VERSION}&quot; \
    -F &quot;test_target=${TEST_TARGET}&quot; \
    -F &quot;test_platform=${TEST_PLATFORM}&quot; \
    -F &quot;testrun=${TEST_RUN}&quot; \</code></pre>
<h4 id="create-job-load-ltcs"><span class="header-section-number">5.5.8.19</span> Create job load-ltcs</h4>
<p>Go to Jenkins &gt; New item</p>
<p>Item name: load-ltcs Select Freestyle project</p>
<p>Click OK</p>
<h4 id="configure-job-load-ltcs"><span class="header-section-number">5.5.8.20</span> Configure job load-ltcs</h4>
<p>Go to Jenkins &gt; load-ltcs &gt; Configure</p>
<p>Select Discard old builds Max # of builds to keep: 5</p>
<p>Build Triggers Select Build periodically Schedule: H 6-20 * * 1-5</p>
<p>Build Click Add build-step, select Execute shell Command:</p>
<pre><code>#!/bin/bash -ex

# JIRA importer aanroepen
data=$(curl -s http://importer.reporting.&lt;your-project&gt;.ictu:4567/import)

if [ &quot;$data&quot; == &#39;Import completed&#39; ]
then
  exit 0
else
  exit 1
fi</code></pre>
<h3 id="application"><span class="header-section-number">5.5.9</span> Application</h3>
<h4 id="add-application-to-docker-dashboard"><span class="header-section-number">5.5.9.1</span> Add application to Docker dashboard</h4>
<p>Go to Docker dashboard &gt; Apps &gt; New App Enter the following app definition:</p>
<pre><code>name: testapp
version: latest

www:
  image: www.docker-registry.&lt;your-project&gt;.ictu:5000/testapp:latest
  enable_ssh: true</code></pre>
<p>Click Save changes</p>
<p>Start app testapp</p>
<!-- Wat is code
hoe organiseren we het nu
laat afhankelijkheden zien tussen applicaties
kan je laten zien hoeveel kennis er eigenlijk nodig is om dit voor mekaar te krijgen
waarom is het zo.

basic ci setup -> laat zien waar problemen zitten.

specificatie template meta. wat moeten we vastleggen.
van elk van de items een voorbeeld uitwerken. -->
<h1 id="stages-of-continuous-delivery"><span class="header-section-number">6</span> Stages of Continuous Delivery</h1>
<p>In this chapter I describe the different stages of continuous delivery that the development organization went through.</p>
<table>
<caption>Demonstration of simple table syntax.</caption>
<thead>
<tr class="header">
<th align="left">Right Le</th>
<th align="left">ft</th>
<th align="left">Center De</th>
<th align="left">fault</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">12 12</td>
<td align="left"></td>
<td align="left">12</td>
<td align="left">12</td>
</tr>
<tr class="even">
<td align="left">123 12</td>
<td align="left">3</td>
<td align="left">123</td>
<td align="left">123</td>
</tr>
<tr class="odd">
<td align="left">1 1</td>
<td align="left"></td>
<td align="left">1</td>
<td align="left">1</td>
</tr>
</tbody>
</table>
<h2 id="stage-1-ci-in-a-shared-environment"><span class="header-section-number">6.1</span> Stage 1: CI in a shared environment</h2>
<div class="figure">
<img src="figures/mermaid/basic-ci-schematic.mermaid.png" alt="CI/CD Schematic Overview " />
<p class="caption">CI/CD Schematic Overview </p>
</div>
<p><strong>Characteristics</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">.</th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">CI/CD Environment</td>
<td align="left">Shared</td>
</tr>
<tr class="even">
<td align="left">Maintenance</td>
<td align="left">System Administrator</td>
</tr>
<tr class="odd">
<td align="left">Deployment</td>
<td align="left">Manual</td>
</tr>
<tr class="even">
<td align="left">Flexibility</td>
<td align="left">Static</td>
</tr>
</tbody>
</table>
<!-- - Shared between teams
- Maintenance by system administrators
- Manual maintenance
- Static deployment servers -->
<p><strong>Systems</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">Server</th>
<th align="left">Type</th>
<th align="left">Depends on</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Subversion</td>
<td align="left">Version Control</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Jenkins</td>
<td align="left">Build Server, CI</td>
<td align="left">Nexus, Sonar, Selenium</td>
</tr>
<tr class="odd">
<td align="left">Nexus</td>
<td align="left">Artifact Repository</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Sonar</td>
<td align="left">Static Code Analysis</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Selenium</td>
<td align="left"></td>
<td align="left">Deployment Server</td>
</tr>
<tr class="even">
<td align="left">Deployment Server</td>
<td align="left"></td>
<td align="left">Nexus</td>
</tr>
</tbody>
</table>
<!-- - Subversion
- Jenkins
- Nexus
- Sonar
- Selenium
- Deployment server -->
<p><strong>Tools</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">Tool</th>
<th align="left">Type</th>
<th align="left">Used by</th>
<th align="left">Depends on</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Maven</td>
<td align="left">Build</td>
<td align="left">Dev, Jenkins</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Java</td>
<td align="left">Language, platform</td>
<td align="left">Dev, Jenkins</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Custom quality reporting</td>
<td align="left">Reporting</td>
<td align="left">Jenkins</td>
<td align="left">Sonar, Selenium</td>
</tr>
</tbody>
</table>
<!--
- Maven
- Java
- Custom quality reporting
- *this list is incomplete* -->
<p><strong>Setup</strong></p>
<ul>
<li>Setup is done by system administrators</li>
</ul>
<p><strong>Manual steps</strong></p>
<table>
<colgroup>
<col width="33%" />
<col width="37%" />
<col width="29%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Task</th>
<th align="left">Depends on</th>
<th align="left">Occurrence</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Create build job</td>
<td align="left">Jenkins</td>
<td align="left">every new unit of development</td>
</tr>
<tr class="even">
<td align="left">Create deployment job</td>
<td align="left">Jenkins</td>
<td align="left">every new unit of development</td>
</tr>
<tr class="odd">
<td align="left">Configure quality report</td>
<td align="left">Jenkins, Quality reporting</td>
<td align="left">every new unit of development</td>
</tr>
<tr class="even">
<td align="left">Maintain server configuration</td>
<td align="left">Deployment Server</td>
<td align="left">on configuration change</td>
</tr>
<tr class="odd">
<td align="left">Trigger deployment</td>
<td align="left">Deployment Server, Jenkins</td>
<td align="left">on request of tester or stakeholder</td>
</tr>
<tr class="even">
<td align="left">Trigger automated tests</td>
<td align="left">Deployment Server, Jenkins, Selenium</td>
<td align="left">every iteration</td>
</tr>
</tbody>
</table>
<!--
- Create build jobs, (once for every unit of development)
- Configure quality reports, (once for every unit of development)
- Manually maintain configuration of deployment server, (every time server configuration changes)
- Tester requests deployment of new version (direct communication)
- Trigger deployment job, (every time a tester requests a new version)
- Trigger automated tests
- *this list is incomplete* -->
<p><strong>Problems</strong></p>
<table>
<colgroup>
<col width="76%" />
<col width="23%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Description</th>
<th align="left">Has negative impact on</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Resource sharing between all teams</td>
<td align="left">Scalability</td>
</tr>
<tr class="even">
<td align="left">Changes and upgrades affect all teams</td>
<td align="left">Stability</td>
</tr>
<tr class="odd">
<td align="left">Teams can't change setup or install plugins</td>
<td align="left">Flexibility, Usability</td>
</tr>
<tr class="even">
<td align="left">Teams can interfere with each other</td>
<td align="left">Stability</td>
</tr>
<tr class="odd">
<td align="left">Teams depend on sysadmins</td>
<td align="left">Agility</td>
</tr>
<tr class="even">
<td align="left">Deployment server changes are difficult to reverse</td>
<td align="left">Flexibility, Scalability</td>
</tr>
<tr class="odd">
<td align="left">Unable to deploy multiple instances of an application</td>
<td align="left">Agility, Usability</td>
</tr>
</tbody>
</table>
<!--

- Limited resources per team
- Doesn't scale beyond N teams
- Changes/upgrades affect all teams
- Teams can't install plugins or make changes to the setup
- Teams can interfere with each other causing difficult to debug and random failures
- Teams request changes to the infrastructure from the system administrators
 - Might take considerable amount of time
 - Request can be denied
- Changes to deployment server are not repeatable
- Difficult to go back N versions of the application and server configuration -->
<h2 id="stage-2-automated-cd-in-a-distributed-environment"><span class="header-section-number">6.2</span> Stage 2: Automated CD in a distributed environment</h2>
<p><strong>Characteristics</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">.</th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">CI/CD Environment</td>
<td align="left">Per team</td>
</tr>
<tr class="even">
<td align="left">Maintenance</td>
<td align="left">Team</td>
</tr>
<tr class="odd">
<td align="left">Deployment</td>
<td align="left">Automatic</td>
</tr>
<tr class="even">
<td align="left">Flexibility</td>
<td align="left">On-demand</td>
</tr>
</tbody>
</table>
<ul>
<li>Each team has his own CI/CD environment</li>
<li>The team is responsible for the environment (DevOps)</li>
<li>Dynamic deployment cluster</li>
<li>Application deployment is scripted</li>
<li>System administrators maintain the deployment cluster</li>
<li>Teams decide what their CI/CD landscape looks like</li>
</ul>
<p><strong>Systems</strong></p>
<ul>
<li>Gitlab</li>
<li>Jenkins</li>
<li>Nexus</li>
<li>Sonar</li>
<li>Selenium</li>
<li>Deployment server</li>
</ul>
<p><strong>Tools</strong></p>
<ul>
<li>Maven</li>
<li>Docker</li>
<li>Custom quality reporting</li>
</ul>
<p><strong>Manual steps</strong></p>
<ul>
<li>s1</li>
</ul>
<p><strong>Problems</strong></p>
<ul>
<li>p1</li>
</ul>
<h2 id="stage-3-----next-evolution.."><span class="header-section-number">6.3</span> Stage 3: --- next evolution..</h2>
<p>tbd..</p>
<h2 id="initial-situation"><span class="header-section-number">6.4</span> Initial situation</h2>
<p><strong>! This needs to be placed elsewhere and rewritten !</strong></p>
<p>Figure  shows the steps and interactions a developer has with build systems in order to deploy a change in the software to a target server.</p>
<div class="figure">
<img src="figures/mermaid/basic-ci-sequencediag.mermaid.png" alt="Basic CI " />
<p class="caption">Basic CI </p>
</div>
<p>Figure  shows the steps a developer needs to take in order to setup a single source repository and configure the continuous integration pipeline.</p>
<div class="figure">
<img src="figures/mermaid/basic-ci-initial-setup.mermaid.png" alt="Basic CI setup " />
<p class="caption">Basic CI setup </p>
</div>
<p></p>
<!-- 
Do not edit this page.

References are automatically generated from the BibTex file (References.bib)

...which you should create using your reference manager.
-->
<h1 id="references" class="unnumbered">References</h1>
<div id="refs" class="references">

</div>
            </body>
</html>
